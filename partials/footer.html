<footer class="footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <a href="/" class="logo">
          <span class="logo-fit">Fit</span><span class="logo-glue">Glue</span>
        </a>
        <p class="footer-tagline">Connect everywhere, enhance everything.</p>
      </div>

      <div class="footer-column">
        <h4 class="footer-heading">Product</h4>
        <ul class="footer-links">
          <li><a href="/features">Features</a></li>
          <li><a href="/how-it-works">How It Works</a></li>
          <li><a href="/the-magic">The Magic</a></li>
          <li><a href="/pricing">Pricing</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4 class="footer-heading">Company</h4>
        <ul class="footer-links">
          <li><a href="/about">About</a></li>
          <li><a href="/contact">Contact</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4 class="footer-heading">Documentation</h4>
        <ul class="footer-links">
          <li><a href="/guides">Guides</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4 class="footer-heading">Legal</h4>
        <ul class="footer-links">
          <li><a href="/privacy">Privacy Policy</a></li>
          <li><a href="/terms">Terms of Service</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; {{year}} FitGlue. All rights reserved.</p>

      <div class="footer-social">
        <a href="https://github.com/ripixel/fitglue-server" aria-label="GitHub" target="_blank" rel="noopener">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" />
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>

<!-- Enhanced Magic Animations Script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Platform rotation data
    const sources = [
      { icon: 'ðŸ‹ï¸', label: 'Hevy' },
      { icon: 'âŒš', label: 'Fitbit' },
      { icon: 'âŒš', label: 'Garmin' },
      { icon: 'ðŸŽ', label: 'Apple Health' }
    ];

    const destinations = [
      { icon: 'ðŸš´', label: 'Strava' },
      { icon: 'ðŸ“Š', label: 'TrainingPeaks' },
      { icon: 'ðŸ“ˆ', label: 'Intervals.icu' }
    ];

    let sourceIndex = 0;
    let destIndex = 0;

    // Rotate platform labels
    function rotatePlatforms() {
      const sourceEl = document.getElementById('flow-source');
      const destEl = document.getElementById('flow-destination');
      if (!sourceEl || !destEl) return;

      const sourceIcon = sourceEl.querySelector('.flow-icon');
      const sourceLabel = sourceEl.querySelector('.flow-label');
      const destIcon = destEl.querySelector('.flow-icon');
      const destLabel = destEl.querySelector('.flow-label');
      if (!sourceIcon || !sourceLabel || !destIcon || !destLabel) return;

      // Fade out
      [sourceIcon, sourceLabel, destIcon, destLabel].forEach(el => el.style.opacity = '0');

      setTimeout(() => {
        sourceIndex = (sourceIndex + 1) % sources.length;
        destIndex = (destIndex + 1) % destinations.length;

        sourceIcon.textContent = sources[sourceIndex].icon;
        sourceLabel.textContent = sources[sourceIndex].label;
        destIcon.textContent = destinations[destIndex].icon;
        destLabel.textContent = destinations[destIndex].label;

        // Fade in
        [sourceIcon, sourceLabel, destIcon, destLabel].forEach(el => el.style.opacity = '1');
      }, 300);
    }

    // Start platform rotation every 4 seconds
    if (document.getElementById('flow-source')) {
      setInterval(rotatePlatforms, 4000);
    }

    // Animate counters
    function animateCounter(element, target) {
      const duration = 2000;
      const start = performance.now();
      const suffix = element.textContent.replace(/[\d,]/g, '');

      function update(currentTime) {
        const elapsed = currentTime - start;
        const progress = Math.min(elapsed / duration, 1);
        const easeProgress = 1 - Math.pow(1 - progress, 3);
        const current = Math.floor(target * easeProgress);
        element.textContent = current.toLocaleString() + suffix;
        if (progress < 1) requestAnimationFrame(update);
      }
      requestAnimationFrame(update);
    }

    // Counter animation observer
    const counterObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const el = entry.target;
          const text = el.textContent || '';
          const numMatch = text.match(/[\d,]+/);
          if (numMatch) {
            const target = parseInt(numMatch[0].replace(/,/g, ''), 10);
            el.textContent = '0' + text.replace(/[\d,]+/, '');
            animateCounter(el, target);
            counterObserver.unobserve(el);
          }
        }
      });
    }, { threshold: 0.5 });

    document.querySelectorAll('.trust-stat-value').forEach(el => counterObserver.observe(el));

    // Header scroll effect
    const header = document.querySelector('.header');
    window.addEventListener('scroll', function () {
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    }, { passive: true });

    // Intersection Observer for scroll animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

    // Observe all animated elements
    document.querySelectorAll('.animate-on-scroll, .stagger-children, .slide-in-left, .slide-in-right, .scale-in').forEach(el => {
      observer.observe(el);
    });

    // Add transition styles for flow labels
    const flowLabels = document.querySelectorAll('.flow-icon, .flow-label');
    flowLabels.forEach(el => {
      el.style.transition = 'opacity 0.3s ease';
    });

    // Carousel functionality
    function initCarousels() {
      document.querySelectorAll('.carousel').forEach(carousel => {
        const track = carousel.querySelector('.carousel-track');
        const items = carousel.querySelectorAll('.carousel-item');
        const nav = carousel.querySelector('.carousel-nav');
        if (!track || items.length === 0) return;

        let currentIndex = 0;
        const itemsPerView = window.innerWidth <= 480 ? 1 : window.innerWidth <= 768 ? 2 : 3;
        const maxIndex = Math.max(0, Math.ceil(items.length / itemsPerView) - 1);

        // Create nav dots
        if (nav) {
          nav.innerHTML = '';
          for (let i = 0; i <= maxIndex; i++) {
            const dot = document.createElement('button');
            dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
            dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
            dot.addEventListener('click', () => goToSlide(i));
            nav.appendChild(dot);
          }
        }

        function goToSlide(index) {
          currentIndex = index;
          const itemWidth = items[0].offsetWidth + 16; // gap
          track.style.transform = `translateX(-${currentIndex * itemWidth * itemsPerView}px)`;
          if (nav) {
            nav.querySelectorAll('.carousel-dot').forEach((dot, i) => {
              dot.classList.toggle('active', i === currentIndex);
            });
          }
        }

        // Auto-advance every 5 seconds
        let autoAdvance = setInterval(() => {
          currentIndex = (currentIndex + 1) % (maxIndex + 1);
          goToSlide(currentIndex);
        }, 5000);

        // Pause on hover
        carousel.addEventListener('mouseenter', () => clearInterval(autoAdvance));
        carousel.addEventListener('mouseleave', () => {
          autoAdvance = setInterval(() => {
            currentIndex = (currentIndex + 1) % (maxIndex + 1);
            goToSlide(currentIndex);
          }, 5000);
        });
      });
    }

    initCarousels();
  });
</script>

<!-- Firebase Auth Check for Header -->
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
  import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';

  async function initAuthCheck() {
    try {
      const response = await fetch('/__/firebase/init.json');
      if (!response.ok) return;
      const config = await response.json();
      if (!config.appId) return;

      const app = initializeApp(config);
      const auth = getAuth(app);

      // Check localStorage cache first for faster initial render
      const cachedAuthState = localStorage.getItem('fitglue_auth_state');
      if (cachedAuthState === 'logged_in') {
        applyLoggedInState();
      }

      onAuthStateChanged(auth, (user) => {
        if (user) {
          localStorage.setItem('fitglue_auth_state', 'logged_in');
          applyLoggedInState();
        } else {
          localStorage.removeItem('fitglue_auth_state');
          applyLoggedOutState();
        }
      });

      function applyLoggedInState() {
        const loginItem = document.getElementById('nav-auth-login');
        const ctaItem = document.getElementById('nav-auth-cta');
        if (loginItem) loginItem.style.display = 'none';
        if (ctaItem) {
          const ctaLink = ctaItem.querySelector('a');
          if (ctaLink) {
            ctaLink.href = '/app';
            ctaLink.textContent = 'Go to Dashboard';
          }
        }
      }

      function applyLoggedOutState() {
        const loginItem = document.getElementById('nav-auth-login');
        const ctaItem = document.getElementById('nav-auth-cta');
        if (loginItem) loginItem.style.display = '';
        if (ctaItem) {
          const ctaLink = ctaItem.querySelector('a');
          if (ctaLink) {
            ctaLink.href = '/auth/register';
            ctaLink.textContent = 'Get Started';
          }
        }
      }
    } catch (e) {
      console.warn('Auth check failed:', e);
    }
  }

  initAuthCheck();
</script>
</body>

</html>
