{{> auth-head}}

<div class="auth-container">
  <h1 class="title">
    <a href="/" class="logo-link">
      <span class="fit">Fit</span><span class="glue">Glue</span>
    </a>
  </h1>
  <h2>Logging Out...</h2>

  <div class="auth-box verification-content">
    <p class="auth-description" id="logout-message">Signing you out...</p>
    <p class="redirect-message">You'll be redirected to the homepage shortly.</p>
  </div>
</div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getAuth, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

  const messageEl = document.getElementById('logout-message');

  async function getFirebaseConfig() {
    try {
      const response = await fetch('/__/firebase/init.json');
      if (response.ok) {
        return await response.json();
      }
    } catch (e) {
      console.warn('Could not load Firebase config:', e);
    }
    return null;
  }

  async function logout() {
    const firebaseConfig = await getFirebaseConfig();
    if (!firebaseConfig) {
      messageEl.textContent = 'Redirecting...';
      setTimeout(() => {
        window.location.href = '/';
      }, 1000);
      return;
    }

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    try {
      await signOut(auth);
      messageEl.textContent = 'You have been logged out successfully.';
      setTimeout(() => {
        window.location.href = '/';
      }, 1500);
    } catch (error) {
      messageEl.textContent = 'Error logging out. Redirecting...';
      setTimeout(() => {
        window.location.href = '/';
      }, 2000);
    }
  }

  logout();
</script>

{{> auth-footer}}
