{{> auth-head}}

<div class="auth-container">
  <h1 class="title">
    <a href="/" class="logo-link">
      <span class="fit">Fit</span><span class="glue">Glue</span>
    </a>
  </h1>
  <h2>Reset Password</h2>

  <div class="auth-box">
    <p class="auth-description">Enter your email address and we'll send you a link to reset your password.</p>

    <div id="auth-error" class="auth-message error" style="display: none;"></div>
    <div id="auth-success" class="auth-message success" style="display: none;"></div>

    <div class="input-group">
      <input type="email" id="email" placeholder="Email" />
    </div>

    <button id="btn-reset" class="btn primary">Send Reset Link</button>

    <p class="switch-auth">
      Remember your password? <a href="/auth/login">Login</a>
    </p>
  </div>
</div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getAuth, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

  const errorEl = document.getElementById('auth-error');
  const successEl = document.getElementById('auth-success');

  function showError(message) {
    successEl.style.display = 'none';
    errorEl.textContent = message;
    errorEl.style.display = 'block';
  }

  function showSuccess(message) {
    errorEl.style.display = 'none';
    successEl.textContent = message;
    successEl.style.display = 'block';
  }

  async function getFirebaseConfig() {
    try {
      const response = await fetch('/__/firebase/init.json');
      if (response.ok) {
        return await response.json();
      }
    } catch (e) {
      console.warn('Could not load Firebase config:', e);
    }
    return null;
  }

  async function init() {
    const firebaseConfig = await getFirebaseConfig();
    if (!firebaseConfig) {
      showError('Could not initialize authentication. Please try again later.');
      return;
    }

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    document.getElementById('btn-reset').addEventListener('click', async () => {
      const email = document.getElementById('email').value;

      try {
        await sendPasswordResetEmail(auth, email);
        showSuccess('Password reset email sent! Check your inbox.');
      } catch (error) {
        showError(error.message);
      }
    });

    document.getElementById('email').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('btn-reset').click();
      }
    });
  }

  init();
</script>

{{> auth-footer}}
