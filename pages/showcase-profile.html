{{>header}}
<link rel="stylesheet" href="/assets/styles/_showcase-shared.css" />

<section class="showcase-page">
    <canvas class="showcase-particles" id="showcase-particles"></canvas>
    <!-- Loading State -->
    <div id="profile-loading" class="showcase-loading">
        <div class="loading-bg-gradient"></div>
        <div class="loading-content">
            <div class="loading-logo">
                <span class="loading-logo-fit">Fit</span>
                <span class="loading-logo-glue">Glue</span>
            </div>
        </div>
    </div>

    <!-- Error State -->
    <div id="profile-error" class="showcase-error">
        <div class="error-icon">üîç</div>
        <h2 class="error-title">Profile not found</h2>
        <p class="error-subtitle">This athlete profile doesn't exist or hasn't been created yet.</p>
        <a href="/" class="btn btn-primary">Explore FitGlue</a>
    </div>

    <!-- Profile Content -->
    <div id="profile-content" class="profile-content" style="display: none;">
        <div class="profile-container">

            <!-- Hero Header -->
            <div class="profile-hero">
                <div id="profile-avatar" class="profile-avatar" style="display: none;"></div>
                <h1 id="profile-name" class="profile-display-name"></h1>
                <p id="profile-subtitle" class="profile-subtitle">FitGlue Athlete</p>
                <p id="profile-bio" class="profile-bio" style="display: none;"></p>
            </div>

            <!-- Headline Stats -->
            <div id="profile-stats" class="profile-stats"></div>

            <!-- Activity List -->
            <div id="profile-activities" class="profile-activities">
                <h2 class="section-title">Showcased Activities</h2>
                <div id="activity-list" class="activity-list"></div>
            </div>

            <!-- CTA banner -->
            <div class="showcase-cta glass-card">
                <div class="cta-content">
                    <h3>Want to enhance your own activities?</h3>
                    <p>FitGlue automatically enriches your workouts with muscle heatmaps, heart rate analysis, and
                        beautiful shareable summaries.</p>
                    <a href="/" class="btn-gradient">Try FitGlue Free ‚Üí</a>
                </div>
            </div>

            <!-- Footer Attribution -->
            <div class="showcase-attribution">
                <span>Powered by</span>
                <a href="/" class="fitglue-logo">
                    <span class="fit">Fit</span><span class="glue">Glue</span>
                </a>
            </div>
        </div>
    </div>

</section>
</main>

<style>
    /* ========================================
     PROFILE PAGE - SPECIFIC STYLES
     ======================================== */

    .profile-content {
        max-width: 960px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    .profile-container {
        padding-top: 2rem;
    }

    /* Hero */
    .profile-hero {
        text-align: center;
        padding: 3rem 0 2rem;
        animation: fadeInUp 0.6s ease-out;
    }

    .profile-display-name {
        font-size: clamp(2rem, 6vw, 3.5rem);
        font-weight: 900;
        letter-spacing: -0.02em;
        background: linear-gradient(135deg, #FF1B8D 0%, #9D4EDD 50%, #4CC9F0 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
    }

    .profile-subtitle {
        color: #999;
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        font-weight: 600;
    }

    /* Profile Avatar */
    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin: 0 auto 1.25rem;
        border: 3px solid rgba(255, 27, 141, 0.4);
        overflow: hidden;
        background: linear-gradient(135deg, rgba(157, 78, 221, 0.3), rgba(255, 27, 141, 0.3));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: 900;
        color: rgba(255, 255, 255, 0.9);
        animation: fadeInUp 0.5s ease-out;
    }

    .profile-avatar--clickable {
        cursor: pointer;
        transition: transform 0.2s ease, border-color 0.2s ease;
    }

    .profile-avatar--clickable:hover {
        transform: scale(1.08);
        border-color: rgba(255, 27, 141, 0.7);
    }

    .profile-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Lightbox */
    .profile-lightbox {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        display: flex;
        align-items: center;
        justify-content: center;
        animation: lightboxFadeIn 0.25s ease-out;
        cursor: pointer;
    }

    .lightbox-image {
        max-width: min(90vw, 600px);
        max-height: 85vh;
        border-radius: 16px;
        box-shadow: 0 24px 80px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.08);
        object-fit: contain;
        cursor: default;
        animation: lightboxScaleIn 0.3s ease-out;
    }

    .lightbox-close {
        position: absolute;
        top: 1.25rem;
        right: 1.5rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: #fff;
        font-size: 1.25rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s, transform 0.2s;
        z-index: 10000;
    }

    .lightbox-close:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
    }

    @keyframes lightboxFadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes lightboxScaleIn {
        from {
            opacity: 0;
            transform: scale(0.85);
        }

        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    /* Profile Bio */
    .profile-bio {
        max-width: 600px;
        margin: 0.75rem auto 0;
        color: #bbb;
        font-size: 0.95rem;
        line-height: 1.6;
        text-align: center;
        white-space: pre-wrap;
    }

    /* Stats Grid */
    .profile-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
        animation: fadeInUp 0.6s ease-out 0.1s backwards;
    }

    .stat-card {
        background: rgba(30, 30, 40, 0.6);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 1.25rem 1rem;
        text-align: center;
        transition: transform 0.2s, border-color 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        border-color: rgba(255, 27, 141, 0.3);
    }

    .stat-value {
        font-size: 1.75rem;
        font-weight: 900;
        letter-spacing: -0.02em;
        color: #fff;
        line-height: 1.2;
    }

    .stat-value.gradient-pink {
        background: linear-gradient(135deg, #FF1B8D, #FF6BB3);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-value.gradient-purple {
        background: linear-gradient(135deg, #9D4EDD, #C77DFF);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-value.gradient-blue {
        background: linear-gradient(135deg, #4CC9F0, #80DAFF);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-value.gradient-green {
        background: linear-gradient(135deg, #06FFA5, #4ADE80);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-value.gradient-orange {
        background: linear-gradient(135deg, #FF9F43, #FFD93D);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-label {
        font-size: 0.75rem;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-top: 0.25rem;
        font-weight: 600;
    }

    /* Activity List */
    .section-title {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 1.25rem;
        color: #fff;
        animation: fadeInUp 0.6s ease-out 0.2s backwards;
    }

    .activity-list {
        display: flex;
        flex-direction: column;
        gap: 0;
        margin-bottom: 2rem;
    }

    /* ---- Date Group ---- */
    .activity-date-group {
        margin-top: 1.25rem;
    }

    .activity-date-group:first-child {
        margin-top: 0;
    }

    .activity-date-header {
        font-size: 0.75rem;
        font-weight: 700;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        padding: 0.5rem 0.25rem;
        margin-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .activity-date-cards {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    /* ---- Activity Card ---- */
    .activity-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: rgba(30, 30, 40, 0.6);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-left: 3px solid var(--cat-color, rgba(255, 255, 255, 0.15));
        border-radius: 16px;
        padding: 1rem 1.25rem;
        text-decoration: none;
        color: #fff;
        transition: all 0.25s ease;
        animation: fadeInUp 0.4s ease-out backwards;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    /* Glow layer on hover */
    .activity-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        width: 120px;
        background: linear-gradient(90deg, var(--cat-color-alpha, transparent), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
    }

    .activity-card:hover {
        border-color: rgba(255, 255, 255, 0.1);
        border-left-color: var(--cat-color, rgba(255, 255, 255, 0.2));
        transform: translateY(-2px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35), 0 0 20px var(--cat-color-alpha, transparent);
    }

    .activity-card:hover::before {
        opacity: 1;
    }

    /* Category colour tokens */
    .activity-card.cat-cardio {
        --cat-color: #FF1B8D;
        --cat-color-alpha: rgba(255, 27, 141, 0.12);
    }

    .activity-card.cat-strength {
        --cat-color: #9D4EDD;
        --cat-color-alpha: rgba(157, 78, 221, 0.12);
    }

    .activity-card.cat-outdoor {
        --cat-color: #06FFA5;
        --cat-color-alpha: rgba(6, 255, 165, 0.10);
    }

    .activity-card.cat-cycling {
        --cat-color: #4CC9F0;
        --cat-color-alpha: rgba(76, 201, 240, 0.12);
    }

    .activity-card.cat-water {
        --cat-color: #4CC9F0;
        --cat-color-alpha: rgba(76, 201, 240, 0.12);
    }

    .activity-card.cat-winter {
        --cat-color: #80DAFF;
        --cat-color-alpha: rgba(128, 218, 255, 0.10);
    }

    .activity-card.cat-mind {
        --cat-color: #C77DFF;
        --cat-color-alpha: rgba(199, 125, 255, 0.10);
    }

    .activity-card.cat-sport {
        --cat-color: #FF9F43;
        --cat-color-alpha: rgba(255, 159, 67, 0.10);
    }

    .activity-card.cat-general {
        --cat-color: #FFD93D;
        --cat-color-alpha: rgba(255, 217, 61, 0.10);
    }

    /* Icon / thumbnail */
    .activity-thumbnail {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        object-fit: cover;
        flex-shrink: 0;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        z-index: 1;
    }

    .activity-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        background: linear-gradient(135deg, var(--cat-color-alpha, rgba(255, 255, 255, 0.04)), rgba(255, 255, 255, 0.03));
        border: 1px solid rgba(255, 255, 255, 0.08);
        position: relative;
        z-index: 1;
    }

    .activity-info {
        flex: 1;
        min-width: 0;
        position: relative;
        z-index: 1;
    }

    .activity-title {
        font-size: 1.05rem;
        font-weight: 700;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 0.4rem;
        letter-spacing: -0.01em;
    }

    .activity-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
        font-size: 0.75rem;
        color: #bbb;
    }

    .activity-meta-item {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 20px;
        padding: 0.2rem 0.55rem;
        font-size: 0.7rem;
        color: #ccc;
        letter-spacing: 0.01em;
    }

    .activity-arrow {
        color: rgba(255, 255, 255, 0.2);
        font-size: 1.25rem;
        flex-shrink: 0;
        transition: color 0.2s, transform 0.2s;
        position: relative;
        z-index: 1;
    }

    .activity-card:hover .activity-arrow {
        color: var(--cat-color, #999);
        transform: translateX(3px);
    }

    /* Responsive */
    @media (max-width: 480px) {
        .profile-stats {
            grid-template-columns: repeat(2, 1fr);
        }

        .activity-thumbnail,
        .activity-icon {
            width: 44px;
            height: 44px;
            font-size: 1.2rem;
            border-radius: 10px;
        }

        .activity-title {
            font-size: 0.95rem;
        }

        .activity-meta-item {
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
        }
    }
</style>

<script>
    // ========================================
    //  SHOWCASE PROFILE - VANILLA JS
    // ========================================

    // Icons keyed by protobuf ActivityType enum value
    const ACTIVITY_TYPE_ICONS = {
        1: '‚õ∑Ô∏è',   // Alpine Ski
        2: '‚õ∑Ô∏è',   // Backcountry Ski
        3: 'üè∏',   // Badminton
        4: 'üõ∂',   // Canoeing
        5: 'üèãÔ∏è',   // CrossFit
        6: 'üö≤',   // E-Bike Ride
        7: 'üèÉ',   // Elliptical
        8: 'üöµ',   // E-Mountain Bike Ride
        9: '‚õ≥',   // Golf
        10: 'üö¥',  // Gravel Ride
        11: '‚ôø',   // Handcycle
        12: 'üî•',  // HIIT
        13: 'ü•æ',  // Hike
        14: '‚õ∏Ô∏è',  // Ice Skate
        15: 'üõº',  // Inline Skate
        16: 'üõ∂',  // Kayaking
        17: 'ü™Å',  // Kitesurf
        18: 'üöµ',  // Mountain Bike Ride
        19: '‚õ∑Ô∏è',  // Nordic Ski
        20: 'üèì',  // Pickleball
        21: 'üßò',  // Pilates
        22: 'üè∏',  // Racquetball
        23: 'üö¥',  // Ride
        24: 'üßó',  // Rock Climbing
        25: '‚õ∑Ô∏è',  // Roller Ski
        26: 'üö£',  // Rowing
        27: 'üèÉ',  // Run
        28: '‚õµ',   // Sail
        29: 'üõπ',  // Skateboard
        30: 'üèÇ',  // Snowboard
        31: 'ü•æ',  // Snowshoe
        32: '‚öΩ',   // Soccer
        33: 'üè∏',  // Squash
        34: 'ü™ú',  // Stair Stepper
        35: 'üèÑ',  // Stand Up Paddling
        36: 'üèÑ',  // Surfing
        37: 'üèä',  // Swim
        38: 'üèì',  // Table Tennis
        39: 'üéæ',  // Tennis
        40: 'üèÉ‚Äç‚ôÇÔ∏è', // Trail Run
        41: 'üö¥',  // Velomobile
        42: 'üö¥',  // Virtual Ride
        43: 'üö£',  // Virtual Row
        44: 'üèÉ',  // Virtual Run
        45: 'üö∂',  // Walk
        46: 'üèãÔ∏è',  // Weight Training
        47: '‚ôø',   // Wheelchair
        48: 'üèÑ',  // Windsurf
        49: 'üí™',  // Workout
        50: 'üßò',  // Yoga
    };

    // Category for gradient accent colour
    const ACTIVITY_CATEGORY = {
        1: 'winter', 2: 'winter', 19: 'winter', 25: 'winter', 30: 'winter', 31: 'winter', 12: 'winter',
        5: 'strength', 46: 'strength', 49: 'strength', 12: 'cardio',
        7: 'cardio', 27: 'cardio', 40: 'cardio', 44: 'cardio', 34: 'cardio', 45: 'cardio',
        6: 'cycling', 8: 'cycling', 10: 'cycling', 18: 'cycling', 23: 'cycling', 41: 'cycling', 42: 'cycling',
        3: 'sport', 9: 'sport', 20: 'sport', 22: 'sport', 32: 'sport', 33: 'sport', 38: 'sport', 39: 'sport',
        4: 'water', 16: 'water', 17: 'water', 26: 'water', 28: 'water', 35: 'water', 36: 'water', 37: 'water', 43: 'water', 48: 'water',
        13: 'outdoor', 24: 'outdoor', 29: 'outdoor',
        21: 'mind', 50: 'mind',
        11: 'general', 14: 'general', 15: 'general', 47: 'general',
    };

    function getActivityIcon(type) {
        return ACTIVITY_TYPE_ICONS[type] || 'üèÖ';
    }

    function formatDistance(meters) {
        if (!meters || meters <= 0) return null;
        if (meters >= 1000) return (meters / 1000).toFixed(1) + ' km';
        return Math.round(meters) + ' m';
    }

    function formatDuration(seconds) {
        if (!seconds || seconds <= 0) return null;
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        if (h > 0) return h + 'h ' + m + 'm';
        return m + 'm';
    }

    function formatDurationLong(seconds) {
        if (!seconds || seconds <= 0) return null;
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        if (h > 0) return h + 'h ' + m + 'm';
        return m + ' min';
    }

    function formatWeight(kg) {
        if (!kg || kg <= 0) return null;
        if (kg >= 1000) return (kg / 1000).toFixed(1) + 't';
        return Math.round(kg).toLocaleString() + ' kg';
    }

    function formatNumber(n) {
        if (!n || n <= 0) return null;
        return n.toLocaleString();
    }

    function formatDate(isoStr) {
        if (!isoStr) return '';
        const d = new Date(isoStr);
        return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    function formatDateGroupHeader(isoStr) {
        if (!isoStr) return 'Unknown Date';
        const d = new Date(isoStr);
        const day = d.getDate();
        const suffix = (day === 1 || day === 21 || day === 31) ? 'st'
            : (day === 2 || day === 22) ? 'nd'
                : (day === 3 || day === 23) ? 'rd' : 'th';
        const weekday = d.toLocaleDateString('en-GB', { weekday: 'long' });
        const month = d.toLocaleDateString('en-GB', { month: 'short' });
        const year = d.getFullYear();
        return weekday + ', ' + day + suffix + ' ' + month + ' ' + year;
    }

    function getDateKey(isoStr) {
        if (!isoStr) return 'unknown';
        const d = new Date(isoStr);
        return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
    }

    function getSlugFromUrl() {
        // Support /u/:slug or ?slug=xxx
        const path = window.location.pathname;
        const uMatch = path.match(/\/u\/([^/]+)/);
        if (uMatch) return uMatch[1];
        const params = new URLSearchParams(window.location.search);
        return params.get('slug') || params.get('u');
    }

    async function loadProfile() {
        const slug = getSlugFromUrl();
        if (!slug) {
            showError();
            return;
        }

        try {
            const apiBase = window.location.hostname === 'localhost'
                ? 'http://localhost:8080'
                : '';

            const resp = await fetch(apiBase + '/api/showcase/profile/' + encodeURIComponent(slug));
            if (!resp.ok) {
                showError();
                return;
            }

            const profile = await resp.json();
            renderProfile(profile);
        } catch (err) {
            console.error('Failed to load profile:', err);
            showError();
        }
    }

    function renderProfile(profile) {
        // Set display name
        document.getElementById('profile-name').textContent = profile.displayName;
        document.title = profile.displayName + ' ‚Äî FitGlue';

        // Set profile avatar
        var avatarEl = document.getElementById('profile-avatar');
        if (profile.profilePictureUrl) {
            avatarEl.innerHTML = '<img src="' + profile.profilePictureUrl + '" alt="' + profile.displayName + '" />';
            avatarEl.style.display = '';
            avatarEl.classList.add('profile-avatar--clickable');
            avatarEl.addEventListener('click', function (e) {
                e.stopPropagation();
                openLightbox(profile.profilePictureUrl, profile.displayName);
            });
        } else if (profile.displayName) {
            avatarEl.textContent = profile.displayName.charAt(0).toUpperCase();
            avatarEl.style.display = 'flex';
        }

        // Set subtitle
        if (profile.subtitle) {
            document.getElementById('profile-subtitle').textContent = profile.subtitle;
        }

        // Set bio
        if (profile.bio) {
            var bioEl = document.getElementById('profile-bio');
            bioEl.textContent = profile.bio;
            bioEl.style.display = '';
        }

        // Build stat cards (only show non-zero)
        const statsContainer = document.getElementById('profile-stats');
        const stats = [];

        stats.push({ value: profile.totalActivities, label: 'Activities', gradient: 'pink' });

        const dist = formatDistance(profile.totalDistanceMeters);
        if (dist) stats.push({ value: dist, label: 'Distance', gradient: 'purple' });

        const dur = formatDurationLong(profile.totalDurationSeconds);
        if (dur) stats.push({ value: dur, label: 'Active Time', gradient: 'blue' });

        const sets = formatNumber(profile.totalSets);
        if (sets) stats.push({ value: sets, label: 'Sets', gradient: 'orange' });

        const reps = formatNumber(profile.totalReps);
        if (reps) stats.push({ value: reps, label: 'Reps', gradient: 'green' });

        const weight = formatWeight(profile.totalWeightKg);
        if (weight) stats.push({ value: weight, label: 'Volume Lifted', gradient: 'orange' });

        statsContainer.innerHTML = stats.map(function (s) {
            return '<div class="stat-card">'
                + '<div class="stat-value gradient-' + s.gradient + '">' + s.value + '</div>'
                + '<div class="stat-label">' + s.label + '</div>'
                + '</div>';
        }).join('');

        // Build activity list (sorted newest first, grouped by date)
        const entries = (profile.entries || []).slice().sort(function (a, b) {
            return new Date(b.startTime || 0) - new Date(a.startTime || 0);
        });

        // Group by date
        var dateGroups = [];
        var currentKey = null;
        entries.forEach(function (entry) {
            var key = getDateKey(entry.startTime);
            if (key !== currentKey) {
                dateGroups.push({ key: key, header: formatDateGroupHeader(entry.startTime), entries: [] });
                currentKey = key;
            }
            dateGroups[dateGroups.length - 1].entries.push(entry);
        });

        var totalIdx = 0;
        const listContainer = document.getElementById('activity-list');
        listContainer.innerHTML = dateGroups.map(function (group) {
            var cardsHtml = group.entries.map(function (entry) {
                var icon = getActivityIcon(entry.activityType);
                var cat = ACTIVITY_CATEGORY[entry.activityType] || 'general';
                var metaParts = [];
                var distStr = formatDistance(entry.distanceMeters);
                if (distStr) metaParts.push('<span class="activity-meta-item">üìè ' + distStr + '</span>');
                var durStr = formatDuration(entry.durationSeconds);
                if (durStr) metaParts.push('<span class="activity-meta-item">‚è± ' + durStr + '</span>');
                if (entry.totalSets > 0) metaParts.push('<span class="activity-meta-item">üèãÔ∏è ' + entry.totalSets + ' sets</span>');

                var thumbnailHtml = entry.routeThumbnailUrl
                    ? '<img class="activity-thumbnail" src="' + entry.routeThumbnailUrl + '" alt="Route" />'
                    : '<div class="activity-icon">' + icon + '</div>';

                var showcaseUrl = '/u/' + encodeURIComponent(getSlugFromUrl()) + '/' + entry.showcaseId;
                var delay = totalIdx * 0.06;
                totalIdx++;

                return '<a href="' + showcaseUrl + '" class="activity-card cat-' + cat + '" style="animation-delay: ' + delay + 's">'
                    + thumbnailHtml
                    + '<div class="activity-info">'
                    + '<div class="activity-title">' + entry.title + '</div>'
                    + '<div class="activity-meta">' + metaParts.join('') + '</div>'
                    + '</div>'
                    + '<span class="activity-arrow">‚Ä∫</span>'
                    + '</a>';
            }).join('');

            return '<div class="activity-date-group">'
                + '<div class="activity-date-header">' + group.header + '</div>'
                + '<div class="activity-date-cards">' + cardsHtml + '</div>'
                + '</div>';
        }).join('');

        // Show content, hide loading
        document.getElementById('profile-loading').style.display = 'none';
        document.getElementById('profile-content').style.display = '';
    }

    function showError() {
        document.getElementById('profile-loading').style.display = 'none';
        document.getElementById('profile-error').style.display = 'block';
    }

    // Lightbox ‚Äì created on body so it escapes .showcase-page overflow:hidden
    var _lightbox = null;
    function ensureLightbox() {
        if (_lightbox) return _lightbox;
        _lightbox = document.createElement('div');
        _lightbox.className = 'profile-lightbox';
        _lightbox.style.display = 'none';
        _lightbox.innerHTML = '<button class="lightbox-close" aria-label="Close">‚úï</button>'
            + '<img class="lightbox-image" src="" alt="" />';
        document.body.appendChild(_lightbox);

        // Close on backdrop / close button click
        _lightbox.addEventListener('click', function (e) {
            if (!_lightbox.querySelector('.lightbox-image').contains(e.target)) {
                closeLightbox();
            }
        });
        return _lightbox;
    }

    function openLightbox(src, alt) {
        var lb = ensureLightbox();
        var img = lb.querySelector('.lightbox-image');
        img.src = src;
        img.alt = alt || '';
        lb.style.display = '';
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        if (_lightbox) {
            _lightbox.style.display = 'none';
            document.body.style.overflow = '';
        }
    }

    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') closeLightbox();
    });

    // Init
    document.addEventListener('DOMContentLoaded', loadProfile);
</script>

<script src="/assets/js/particles.js"></script>
<script>initParticles('showcase-particles');</script>